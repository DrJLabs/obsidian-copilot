# Story 1.2 Risk Profile — Autonomous Runner Integration (2025-09-29)

## Summary

Coordinator integration now ships with targeted unit coverage for marker parity and abort handling alongside telemetry instrumentation for concurrency runs. Remaining risk centers on prompt/context snapshot parity and empirical performance validation before flag enablement. Overall risk rating is **Medium** pending benchmark evidence.

## Overall Risk Score

- Base Score: 100
- Deductions: 2 × Medium (−10)
- **Calculated Score:** 90 / 100 (Medium)

## Risk Matrix

| Risk ID  | Description                                                                                                                        | Probability | Impact     | Score | Priority |
| -------- | ---------------------------------------------------------------------------------------------------------------------------------- | ----------- | ---------- | ----- | -------- |
| TECH-102 | Hook wiring causes marker drift or misordered aggregation when coordinator results feed back into `processToolResults`.            | Low (1)     | Medium (2) | 2     | Low      |
| OPS-102  | Feature flag or concurrency clamp not honored, enabling parallel flow when disabled or allowing caps outside 1..10.                | Low (1)     | Medium (2) | 2     | Low      |
| PERF-102 | Parallel execution in the runner triggers redundant hook invocations or thrashes observability spans, inflating latency telemetry. | Medium (2)  | Medium (2) | 4     | Medium   |
| QA-102   | Missing integration tests for autonomous runner leave prompt-parity scenario unverified.                                           | Medium (2)  | Medium (2) | 4     | Medium   |

## Detailed Risk Register

| Risk ID  | Category          | Affected Components                                                                                     | Detection Method                                                                                                 | Mitigation Strategy                                                                                                | Owner           | Status    |
| -------- | ----------------- | ------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | --------------- | --------- |
| TECH-102 | Technical         | `executeCoordinatorFlow`, marker hooks, `toolResultUtils.processToolResults`                            | Parallel execution helper unit tests (`parallelExecution.test.ts`) validate marker parity and abort suppression. | Maintain regression coverage for marker ordering/background suppression; extend snapshot parity under QA-102 item. | Dev Agent + QA  | Mitigated |
| OPS-102  | Operational       | Feature flag checks, configuration clamp (`parallelToolCalls.enabled`, `parallelToolCalls.concurrency`) | Settings sanitization (`src/settings/model.ts`) and shared resolver (`parallelConfig.ts`).                       | Monitor config changes via telemetry summary log; no additional action required pre-flag enablement.               | Dev Agent + Ops | Closed    |
| PERF-102 | Performance       | Span telemetry (`tool.start`/`tool.settle`), coordinator summary logging                                | `[parallel] execution summary` log emitted per run with duration feed.                                           | Capture benchmark comparing sequential vs parallel wall time before toggling flag for production cohort.           | Dev Agent + SRE | Open      |
| QA-102   | Quality Assurance | Prompt/context parity validation                                                                        | Trace matrix still lists AC2 as partial; snapshot parity pending.                                                | Add runner-level sequential vs parallel snapshot comparison test to close parity gap.                              | QA Team         | Open      |

## Risk-Based Testing Strategy

1. **Critical/High (TECH-102)**

   - Execute integration tests that feed mixed-latency tool stubs through the runner while asserting marker order and aggregated prompt equality.
   - Add snapshot comparisons for prompt/context outputs under both sequential and parallel paths to catch ordering regressions. [Source: docs/architecture/6-runner-integration.md#61-autonomous]

2. **Medium (OPS-102, QA-102)**

   - Automate feature-flag toggle tests verifying sequential fallback executes when `enabled` is false or concurrency is out of range. [Source: docs/architecture/7-config-feature-flags.md]
   - Ensure abort-handling suites execute with `AbortController` to confirm no post-abort hook emissions. [Source: docs/architecture/5-coordinator-design.md#53-error-timeout-cancel]

3. **Low (PERF-102)**
   - Add telemetry regression checks measuring span counts and wall time before/after integration when cap=4; alert on >10% variance. [Source: docs/architecture/8-observability.md]

## Risk Mitigation Recommendations

- Prioritize integration test implementation before feature flag enablement; treat TECH-102 as blocking for release.
- Codify configuration validation in a shared helper invoked by both sequential and parallel paths to minimize OPS-102 exposure.
- Instrument dashboards watching span rate, abort counts, and concurrency metrics for early detection.

## Monitoring & Review

- Monitor `tool.start`/`tool.settle` span volume and latency histograms once the feature flag toggles on.
- Revisit this risk profile after the Copilot+ integration (Story 1.3) to ensure shared mitigations remain valid.

---

Risk profile: docs/qa/assessments/1.2-autonomous-runner-integration-risk-20250929.md
