# Requirements Traceability Matrix

## Story: 1.3 – Copilot+ Integration & Telemetry

### Coverage Summary

- Total Requirements: 4
- Fully Covered: 4 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: With `parallelToolCalls.enabled` active, CopilotPlusChainRunner routes tool execution through the coordinator while preserving marker behaviour for foreground/background tools.

**Coverage: FULL**

- test_file: `src/LLMProviders/chainRunner/__tests__/CopilotPlusParallelExecution.test.ts`
  - test_case: `routes tool execution through the coordinator when parallel mode is enabled`
  - Given: Copilot+ runner receives visible + background tool calls with flag on
  - When: `executeToolCalls` executes via coordinator mocks
  - Then: Coordinator hooks capture metadata and ordered outputs while background tool remains silent
  - coverage: integration (mocked coordinator path)
- test_file: `src/LLMProviders/chainRunner/__tests__/parallelExecution.test.ts`
  - test_case: `updates markers for visible tools only and records telemetry`
  - Given: Coordinator flow executes mixed tool set with hooks
  - When: Hooks fire on start/settle for each tool
  - Then: Visible markers update, background markers suppressed, summary logged
  - coverage: integration

#### AC2: Ordered ToolResult[] feeds Copilot+ aggregation so prompt/context strings, citations, and localSearch formatting remain byte-identical to sequential execution.

**Coverage: FULL**

- test_file: `src/LLMProviders/chainRunner/__tests__/CopilotPlusParallelExecution.test.ts`
  - test_case: `routes tool execution through the coordinator when parallel mode is enabled`
  - Given: Coordinator returns formatted localSearch + webSearch payloads
  - When: Copilot+ aggregates results from coordinator output
  - Then: Outputs preserve XML formatting for localSearch and JSON for other tools
  - coverage: integration
- test_file: `src/LLMProviders/chainRunner/__tests__/parallelExecution.test.ts`
  - test_case: `preserves prompt aggregation parity with sequential flow`
  - Given: Sequential and parallel tool results for mixed tool set
  - When: `processToolResults` runs for both
  - Then: Aggregated strings match exactly
  - coverage: integration

#### AC3: Telemetry spans/logging emit tool.start/tool.settle metadata and bounded execution summary for Copilot+ runs.

**Coverage: FULL**

- test_file: `src/LLMProviders/chainRunner/__tests__/parallelExecution.test.ts`
  - test_case: `records span durations for telemetry analysis`
  - Given: Coordinator executes two visible tools with distinct durations
  - When: Hooks emit telemetry for start/settle events
  - Then: `[parallel] execution summary` logs duration histogram and `emitToolSpan` captures start/settle metadata with concurrency cap
  - coverage: integration (coordinator helper exercising hooks)
- test_file: `src/LLMProviders/chainRunner/__tests__/CopilotPlusParallelExecution.test.ts`
  - test_case: `routes tool execution through the coordinator when parallel mode is enabled`
  - Given: Copilot+ runner invokes coordinator with visible/background tools
  - When: Execution completes via coordinator stub
  - Then: Logging/assertions ensure summary and sources propagate without duplication
  - coverage: integration

#### AC4: Feature flag, abort, and Plus gating propagate correctly so sequential fallback and abort suppression work.

**Coverage: FULL**

- test_file: `src/LLMProviders/chainRunner/__tests__/CopilotPlusParallelExecution.test.ts`
  - test_case: `propagates abort results returned by the coordinator`
  - Given: Coordinator returns cancelled ToolResult while signal aborted
  - When: Copilot+ processes coordinator output
  - Then: Final toolOutputs surfaces `Aborted` status without post-abort markers
  - coverage: integration
- test_file: `src/LLMProviders/chainRunner/__tests__/CopilotPlusParallelExecution.test.ts`
  - test_case: `falls back to sequential execution when parallel mode is disabled`
  - Given: Feature flag disabled or cap invalid
  - When: `executeToolCalls` runs with single tool
  - Then: Sequential ToolManager path executes with loading reset
  - coverage: unit/integration

### Coverage Gaps

None.

### Test Design Alignment

- Reference: `docs/qa/assessments/1.3-copilot-plus-integration-test-design-20250929.md`
- Outstanding scenarios: None — telemetry benchmark scenario 1.3-INT-005 satisfied via span duration assertions in `parallelExecution.test.ts`.

### Risk Assessment

- High Risk: None (no uncovered ACs)
- Medium Risk: Telemetry instrumentation verification outstanding
- Low Risk: N/A

Trace matrix: docs/qa/assessments/1.3-copilot-plus-integration-trace-20250929.md
